<div class="container">
  <div class="page-header">
    <div>
      <h1 class="page-title">üéì Rapport d'Activit√© Apprenant</h1>
      <p style="color: var(--gray-600); margin-top: 0.5rem;"><%= @report[:user][:name] %> (<%= @report[:user][:email] %>)</p>
    </div>
    <%= link_to "‚Üê Retour", formateur_activity_reports_path(date: @date), class: "btn btn-outline" %>
  </div>

  <div class="card">
    <div class="card-body">
      <%= form_with url: user_report_formateur_activity_report_path(@user), method: :get, class: "form-group" do |f| %>
        <div style="display: flex; gap: 1rem; align-items: flex-end;">
          <div style="flex: 1;">
            <%= f.label :date, "Mois", class: "form-label" %>
            <%= f.month_field :date, value: @date.strftime('%Y-%m'), class: "form-control" %>
          </div>
          <%= f.submit "Filtrer", class: "btn btn-primary" %>
        </div>
      <% end %>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      üìä Statistiques - <%= @report[:period] %>
    </div>
    <div class="card-body">
      <div class="dashboard-grid">
        <div class="stat-card">
          <h3><%= @report[:stats][:total_activities] %></h3>
          <p>Total Activit√©s</p>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, var(--secondary-color), #059669);">
          <h3><%= @report[:stats][:logins] %></h3>
          <p>Connexions</p>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, #8b5cf6, #6366f1);">
          <h3><%= @report[:stats][:active_days] %></h3>
          <p>Jours Actifs</p>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, var(--warning-color), #d97706);">
          <h3><%= @report[:stats][:active_days] > 0 ? (((@report[:stats][:active_days].to_f / 30) * 100).round(0)) : 0 %>%</h3>
          <p>Engagement</p>
        </div>
      </div>

      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin-top: 2rem;">
        <div>
          <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">üìù Activit√©s Quiz</h3>
          <div style="background: var(--gray-50); padding: 1rem; border-radius: var(--border-radius);">
            <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid var(--gray-200);">
              <span style="color: var(--gray-600);">Quiz d√©marr√©s</span>
              <strong><%= @report[:stats][:quizzes_started] %></strong>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid var(--gray-200);">
              <span style="color: var(--gray-600);">Quiz compl√©t√©s</span>
              <strong style="color: var(--secondary-color);"><%= @report[:stats][:quizzes_completed] %></strong>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid var(--gray-200);">
              <span style="color: var(--gray-600);">Quiz abandonn√©s</span>
              <strong style="color: var(--danger-color);"><%= @report[:stats][:quizzes_abandoned] %></strong>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 0.75rem 0;">
              <span style="color: var(--gray-600);">Taux de compl√©tion</span>
              <strong><%= @report[:stats][:quizzes_started] > 0 ? ((@report[:stats][:quizzes_completed].to_f / @report[:stats][:quizzes_started]) * 100).round(1) : 0 %>%</strong>
            </div>
          </div>
        </div>

        <div>
          <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">üìÖ P√©riode d'Activit√©</h3>
          <div style="background: var(--gray-50); padding: 1rem; border-radius: var(--border-radius);">
            <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid var(--gray-200);">
              <span style="color: var(--gray-600);">Premi√®re activit√©</span>
              <strong><%= @report[:stats][:first_activity]&.strftime('%d/%m/%Y %H:%M') || 'N/A' %></strong>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 0.75rem 0;">
              <span style="color: var(--gray-600);">Derni√®re activit√©</span>
              <strong><%= @report[:stats][:last_activity]&.strftime('%d/%m/%Y %H:%M') || 'N/A' %></strong>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      üéØ Performance Quiz
    </div>
    <div class="card-body">
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
        <div style="background: var(--gray-50); border: 2px solid var(--gray-200); border-radius: var(--border-radius); padding: 1.5rem; text-align: center;">
          <p style="color: var(--gray-600); font-size: 0.875rem; margin-bottom: 0.5rem;">Total Tentatives</p>
          <p style="font-size: 2rem; font-weight: 700;"><%= @report[:quiz_performance][:total_attempts] %></p>
        </div>
        <div style="background: var(--gray-50); border: 2px solid var(--secondary-color); border-radius: var(--border-radius); padding: 1.5rem; text-align: center;">
          <p style="color: var(--gray-600); font-size: 0.875rem; margin-bottom: 0.5rem;">Compl√©t√©s</p>
          <p style="font-size: 2rem; font-weight: 700; color: var(--secondary-color);"><%= @report[:quiz_performance][:completed] %></p>
        </div>
        <div style="background: var(--gray-50); border: 2px solid var(--primary-color); border-radius: var(--border-radius); padding: 1.5rem; text-align: center;">
          <p style="color: var(--gray-600); font-size: 0.875rem; margin-bottom: 0.5rem;">R√©ussis</p>
          <p style="font-size: 2rem; font-weight: 700; color: var(--primary-color);"><%= @report[:quiz_performance][:passed] %></p>
        </div>
        <div style="background: var(--gray-50); border: 2px solid #8b5cf6; border-radius: var(--border-radius); padding: 1.5rem; text-align: center;">
          <p style="color: var(--gray-600); font-size: 0.875rem; margin-bottom: 0.5rem;">Score Moyen</p>
          <p style="font-size: 2rem; font-weight: 700; color: #8b5cf6;"><%= @report[:quiz_performance][:average_score] %>%</p>
        </div>
        <div style="background: var(--gray-50); border: 2px solid var(--warning-color); border-radius: var(--border-radius); padding: 1.5rem; text-align: center;">
          <p style="color: var(--gray-600); font-size: 0.875rem; margin-bottom: 0.5rem;">Temps Total</p>
          <p style="font-size: 2rem; font-weight: 700; color: var(--warning-color);"><%= (@report[:quiz_performance][:total_time_spent] / 60.0).round(1) %>m</p>
        </div>
      </div>
    </div>
  </div>

  <% if @report[:stats][:total_activities] == 0 %>
    <div class="card" style="background-color: #fef3c7; border-left: 4px solid var(--warning-color);">
      <div class="card-body">
        <div style="display: flex; align-items: center; gap: 1rem;">
          <div style="font-size: 2rem;">‚ö†Ô∏è</div>
          <div>
            <strong style="color: #92400e;">Attention</strong>
            <p style="color: #92400e; margin-top: 0.25rem;">
              Cet apprenant n'a enregistr√© aucune activit√© ce mois-ci.
            </p>
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>
